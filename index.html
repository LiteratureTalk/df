<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Logo Camera Overlay</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
            aspect-ratio: 4/3;
        }

        #videoElement, #canvas, #overlayCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #canvas {
            display: none;
        }

        #overlayCanvas {
            pointer-events: none;
            z-index: 10;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .logo-controls {
            background: rgba(240, 240, 240, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            border: none;
        }

        .value-display {
            display: inline-block;
            margin-left: 10px;
            color: #764ba2;
            font-weight: 600;
        }

        #photoGallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(240, 240, 240, 0.5);
            border-radius: 15px;
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .status.ready {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            button {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
    <div class="container">
        <h1>üì∑ 3D Logo Camera</h1>
        
        <div id="status" class="status loading">Initializing camera...</div>
        
        <div class="camera-container">
            <video id="videoElement" autoplay></video>
            <canvas id="canvas"></canvas>
            <canvas id="overlayCanvas"></canvas>
        </div>

        <div class="logo-controls">
            <div class="control-group">
                <label>Logo Size: <span class="value-display" id="sizeValue">1.0</span></label>
                <input type="range" id="logoSize" min="0.1" max="3" step="0.1" value="1">
            </div>
            
            <div class="control-group">
                <label>Horizontal Position: <span class="value-display" id="xValue">0</span></label>
                <input type="range" id="logoX" min="-5" max="5" step="0.1" value="0">
            </div>
            
            <div class="control-group">
                <label>Vertical Position: <span class="value-display" id="yValue">0</span></label>
                <input type="range" id="logoY" min="-5" max="5" step="0.1" value="0">
            </div>
            
            <div class="control-group">
                <label>Rotation: <span class="value-display" id="rotValue">0¬∞</span></label>
                <input type="range" id="logoRotation" min="0" max="360" step="1" value="0">
            </div>
        </div>

        <div class="controls">
            <button id="captureBtn" class="btn-primary" disabled>üì∏ Capture Photo</button>
            <button id="switchBtn" class="btn-secondary">üîÑ Switch Camera</button>
            <button id="downloadAllBtn" class="btn-secondary" disabled>‚¨áÔ∏è Download All</button>
        </div>

        <div id="photoGallery"></div>
    </div>

    <script>
        let video = document.getElementById('videoElement');
        let canvas = document.getElementById('canvas');
        let overlayCanvas = document.getElementById('overlayCanvas');
        let ctx = canvas.getContext('2d');
        let captureBtn = document.getElementById('captureBtn');
        let switchBtn = document.getElementById('switchBtn');
        let downloadAllBtn = document.getElementById('downloadAllBtn');
        let photoGallery = document.getElementById('photoGallery');
        let statusDiv = document.getElementById('status');
        
        let currentStream = null;
        let facingMode = 'user';
        let photos = [];
        
        // Three.js variables
        let scene, camera3D, renderer, logoModel;
        let logoSettings = {
            size: 1,
            x: 0,
            y: 0,
            rotation: 0
        };
        
        // Initialize Three.js
        function initThreeJS() {
            scene = new THREE.Scene();
            camera3D = new THREE.PerspectiveCamera(75, overlayCanvas.width / overlayCanvas.height, 0.1, 1000);
            camera3D.position.z = 5;
            
            renderer = new THREE.WebGLRenderer({ 
                canvas: overlayCanvas, 
                alpha: true,
                antialias: true 
            });
            renderer.setClearColor(0x000000, 0);
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            
            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // Load 3D model
            loadModel();
            
            // Start animation
            animate();
        }
        
        function loadModel() {
            const loader = new THREE.GLTFLoader();
            
            // Try to load the logo.glb file
            loader.load(
                'logo.glb',
                function (gltf) {
                    logoModel = gltf.scene;
                    scene.add(logoModel);
                    statusDiv.textContent = '3D logo loaded successfully!';
                    statusDiv.className = 'status ready';
                },
                function (xhr) {
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                function (error) {
                    console.warn('Could not load logo.glb, using fallback 3D object');
                    // Create a fallback 3D object if logo.glb is not found
                    createFallbackLogo();
                    statusDiv.textContent = 'Using fallback logo (logo.glb not found)';
                    statusDiv.className = 'status ready';
                }
            );
        }
        
        function createFallbackLogo() {
            // Create a colorful fallback logo with "ABC" text representation
            const group = new THREE.Group();
            
            // Create three interconnected rings representing Act, Belong, Commit
            const geometry = new THREE.TorusGeometry(0.8, 0.2, 8, 20);
            
            // Ring 1 - Act (red)
            const material1 = new THREE.MeshPhongMaterial({ 
                color: 0xff4444,
                emissive: 0xff0000,
                emissiveIntensity: 0.2
            });
            const ring1 = new THREE.Mesh(geometry, material1);
            ring1.position.x = -0.6;
            
            // Ring 2 - Belong (green)
            const material2 = new THREE.MeshPhongMaterial({ 
                color: 0x44ff44,
                emissive: 0x00ff00,
                emissiveIntensity: 0.2
            });
            const ring2 = new THREE.Mesh(geometry, material2);
            ring2.rotation.z = Math.PI / 3;
            
            // Ring 3 - Commit (blue)
            const material3 = new THREE.MeshPhongMaterial({ 
                color: 0x4444ff,
                emissive: 0x0000ff,
                emissiveIntensity: 0.2
            });
            const ring3 = new THREE.Mesh(geometry, material3);
            ring3.position.x = 0.6;
            ring3.rotation.z = -Math.PI / 3;
            
            group.add(ring1);
            group.add(ring2);
            group.add(ring3);
            
            logoModel = group;
            scene.add(logoModel);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (logoModel) {
                logoModel.rotation.y += 0.01;
                updateLogoTransform();
            }
            
            const width = overlayCanvas.clientWidth;
            const height = overlayCanvas.clientHeight;
            
            if (overlayCanvas.width !== width || overlayCanvas.height !== height) {
                renderer.setSize(width, height);
                camera3D.aspect = width / height;
                camera3D.updateProjectionMatrix();
            }
            
            renderer.render(scene, camera3D);
        }
        
        function updateLogoTransform() {
            if (!logoModel) return;
            
            logoModel.scale.set(logoSettings.size, logoSettings.size, logoSettings.size);
            logoModel.position.x = logoSettings.x;
            logoModel.position.y = logoSettings.y;
            logoModel.rotation.z = logoSettings.rotation * Math.PI / 180;
        }
        
        // Control handlers
        document.getElementById('logoSize').addEventListener('input', (e) => {
            logoSettings.size = parseFloat(e.target.value);
            document.getElementById('sizeValue').textContent = e.target.value;
        });
        
        document.getElementById('logoX').addEventListener('input', (e) => {
            logoSettings.x = parseFloat(e.target.value);
            document.getElementById('xValue').textContent = e.target.value;
        });
        
        document.getElementById('logoY').addEventListener('input', (e) => {
            logoSettings.y = parseFloat(e.target.value);
            document.getElementById('yValue').textContent = e.target.value;
        });
        
        document.getElementById('logoRotation').addEventListener('input', (e) => {
            logoSettings.rotation = parseFloat(e.target.value);
            document.getElementById('rotValue').textContent = e.target.value + '¬∞';
        });
        
        // Camera functions
        async function startCamera() {
            try {
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 960 }
                    }
                };
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
                
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    captureBtn.disabled = false;
                    statusDiv.textContent = 'Camera ready!';
                    statusDiv.className = 'status ready';
                };
            } catch (err) {
                console.error('Error accessing camera:', err);
                statusDiv.textContent = 'Error: Unable to access camera';
                statusDiv.className = 'status error';
            }
        }
        
        function capturePhoto() {
            // Draw video frame to canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Create a temporary canvas for the 3D overlay
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw the video frame
            tempCtx.drawImage(canvas, 0, 0);
            
            // Draw the 3D overlay
            const overlayData = renderer.domElement.toDataURL('image/png');
            const overlayImg = new Image();
            overlayImg.onload = () => {
                // Calculate scaling to maintain aspect ratio
                const scale = Math.min(canvas.width / overlayCanvas.width, canvas.height / overlayCanvas.height);
                const overlayWidth = overlayCanvas.width * scale;
                const overlayHeight = overlayCanvas.height * scale;
                const offsetX = (canvas.width - overlayWidth) / 2;
                const offsetY = (canvas.height - overlayHeight) / 2;
                
                tempCtx.drawImage(overlayImg, offsetX, offsetY, overlayWidth, overlayHeight);
                
                // Get the final image
                const dataUrl = tempCanvas.toDataURL('image/jpeg', 0.95);
                
                // Add to gallery
                addPhotoToGallery(dataUrl);
                
                // Flash effect
                video.style.opacity = '0';
                setTimeout(() => {
                    video.style.opacity = '1';
                }, 200);
            };
            overlayImg.src = overlayData;
        }
        
        function addPhotoToGallery(dataUrl) {
            photos.push(dataUrl);
            
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            
            const img = document.createElement('img');
            img.src = dataUrl;
            img.onclick = () => downloadPhoto(dataUrl, photos.length);
            
            photoItem.appendChild(img);
            photoGallery.appendChild(photoItem);
            
            downloadAllBtn.disabled = false;
        }
        
        function downloadPhoto(dataUrl, index) {
            const link = document.createElement('a');
            link.download = `photo_with_logo_${index || photos.length}.jpg`;
            link.href = dataUrl;
            link.click();
        }
        
        function downloadAllPhotos() {
            photos.forEach((dataUrl, index) => {
                setTimeout(() => {
                    downloadPhoto(dataUrl, index + 1);
                }, index * 500);
            });
        }
        
        function switchCamera() {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            startCamera();
        }
        
        // Event listeners
        captureBtn.addEventListener('click', capturePhoto);
        switchBtn.addEventListener('click', switchCamera);
        downloadAllBtn.addEventListener('click', downloadAllPhotos);
        
        // Initialize
        window.addEventListener('load', () => {
            initThreeJS();
            startCamera();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
